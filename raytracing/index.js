!function webpackUniversalModuleDefinition(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.appLibrary=r():e.appLibrary=r()}(this,(()=>(()=>{var e={243:e=>{e.exports="#version 300 es\nprecision highp float;\n\nuniform sampler2D color;\n\nin vec2 uv;\nout vec4 outColor;\n\nvoid main() {\n    outColor = vec4(texture(color, uv).xyz, 1.0);\n}\n"},276:e=>{e.exports="#version 300 es\nlayout(location = 0) in vec3 position;\n\nout vec2 uv;\n\nvoid main() {\n    uv = (position.xy + 1.0) * 0.5;\n    gl_Position = vec4(position, 1.0);\n}\n"},437:e=>{e.exports="// Header in js program\n\n#define EPS -0.00001\n\nstruct Face {\n    vec4 a;\n    vec4 b;\n    vec4 c;\n    vec4 n;\n};\n\nuniform sampler2D inColor;\nuniform sampler2D inPos;\nuniform sampler2D inDir;\nuniform float inStep;\n\nlayout(std140) uniform Model {\n    Face face[FACES_COUNT];\n} model;\n\nin vec2 uv;\nout vec4 color[3];\n\nvec3 env(vec3 n) {\n    vec3 ret = mix(vec3(0.2, 0.2, 0.2), vec3(0.8, 0.9, 1.0) * 2.0, (dot(n, vec3(0.0, 1.0, 0.0)) + 1.0) * 0.5);\n    return ret;\n}\n\nfloat fresnelSchlick(float nIn, float nOut, vec3 direction, vec3 normal) {\n    float R0 = ((nOut - nIn) * (nOut - nIn)) / ((nOut + nIn) * (nOut + nIn));\n    float fresnel = R0 + (1.0 - R0) * pow((1.0 - abs(dot(direction, normal))), 5.0);\n    return fresnel;\n}\n\nvec3 idealRefract(vec3 direction, vec3 normal, float nIn, float nOut) {\n    bool fromOutside = dot(normal, direction) < 0.0;\n    float ratio = fromOutside ? nOut / nIn : nIn / nOut;\n\n    vec3 refraction, reflection;\n    refraction = fromOutside ? refract(direction, normal, ratio) : -refract(-direction, normal, ratio);\n    reflection = reflect(direction, normal);\n\n    return refraction == vec3(0.0) ? reflection : refraction;\n}\n\nvoid main() {\n    vec2 tuv = (uv + 1.0) * 0.5;\n\n    vec4 col = texture(inColor, tuv);\n    vec4 pos = texture(inPos, tuv);\n    vec4 dirColor = texture(inDir, tuv);\n    vec4 dir = vec4(dirColor.xyz, 0.0);\n    float k = dirColor.w;\n\n    vec4 rlColor = vec4(0.0);\n    vec4 rlDir = dir;\n    vec4 rrDir = dir;\n    vec4 rrPos = pos;\n    float rrk = 1.0;\n    float minT = 1000000.0;\n\n    color[0] = col;\n\n    for (int i = 0; i < FACES_COUNT; i++) {\n        mat4 m = transpose(mat4(model.face[i].a, model.face[i].b, model.face[i].c, vec4(0.0, 0.0, 0.0, 1.0)));\n        vec3 n = model.face[i].n.xyz;\n\n        vec4 pos2 = m * pos;\n        vec4 dir2 = m * dir;\n\n        float t = -pos2.z / dir2.z;\n        vec2 uvc = pos2.xy + t * dir2.xy;\n\n        if (uvc.x >= EPS && uvc.y >= EPS && uvc.x + uvc.y <= 1.0 - EPS && t < minT && t > -EPS) {\n            bool fromOutside = dot(n, dir.xyz) < 0.0;\n            float nIn = fromOutside ? 2.417 : 1.0;\n            float nOut = fromOutside ? 1.0 : 2.417;\n\n            rrk = fresnelSchlick(nIn, nOut, dir.xyz, n);\n            if (fromOutside == false) { rrk = 1.0 - rrk; }\n            minT = t;\n\n            rrPos = pos + dir * t;\n            rrDir = vec4(idealRefract(dir.xyz, n, nIn, nOut), rrk * k);\n            rlDir = vec4(reflect(dir.xyz, n), rrk * k);\n\n            if (fromOutside == false) {\n                vec4 tmp = rrDir;\n                rrDir = rlDir;\n                rlDir = tmp;\n            }\n        }\n    }\n\n    color[0] += vec4(env(rlDir.xyz), 1.0) * k * rrk;\n    color[1] = rrPos;\n    color[2] = rrDir;\n}\n"},619:e=>{e.exports="#version 300 es\nlayout(location = 0) in vec3 position;\n\nout vec2 uv;\n\nvoid main() {\n    uv = position.xy;\n    gl_Position = vec4(position, 1.0);\n}\n"}},r={};function __webpack_require__(i){var t=r[i];if(void 0!==t)return t.exports;var n=r[i]={exports:{}};return e[i](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(r,{a:r}),r},__webpack_require__.d=(e,r)=>{for(var i in r)__webpack_require__.o(r,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:r[i]})},__webpack_require__.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";__webpack_require__.r(i);var e,r,t,n,o,c,a,f,v,s,l,u,D,d,_,E,h,T,m,R,F,w,A,p,b,x,U,O,y,M,C,g=__webpack_require__(619),S=__webpack_require__.n(g),P=__webpack_require__(437),L=__webpack_require__.n(P),B=__webpack_require__(276),I=__webpack_require__.n(B),k=__webpack_require__(243),N=__webpack_require__.n(k),__classPrivateFieldSet=function(e,r,i,t,n){if("m"===t)throw new TypeError("Private method is not writable");if("a"===t&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof r?e!==r||!n:!r.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===t?n.call(e,i):n?n.value=i:r.set(e,i),i},__classPrivateFieldGet=function(e,r,i,t){if("a"===i&&!t)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?e!==r||!t:!r.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?t:"a"===i?t.call(e):t?t.value:r.get(e)};class Device{static create(i,f,s){const l=document.createElement("canvas");document.body.appendChild(l),l.width=i,l.height=f,l.style.position="absolute",l.style.top="10px",l.style.left="10px",l.style.width=`${i}px`,l.style.height=`${f}px`;const u=l.getContext("webgl2");if(null===u)throw new Error("WebGL2 not supported.");__classPrivateFieldSet(this,e,u,"f",n),__classPrivateFieldSet(this,e,l,"f",o);if(null===u.getExtension("EXT_color_buffer_float"))throw new Error("Fatal error.");__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",M).call(Device),"f",r),__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",A).call(Device),"f",t),__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",y).call(Device,I(),N()),"f",c);const D="#version 300 es\nprecision highp float;\n#define FACES_COUNT 1\n"+L();__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",y).call(Device,S(),D),"f",a);const d=u.getUniformLocation(__classPrivateFieldGet(Device,e,"f",c),"color");if(null===d)throw new Error("Fatal error.");u.useProgram(__classPrivateFieldGet(Device,e,"f",c)),u.uniform1i(d,0);const _=u.getUniformLocation(__classPrivateFieldGet(Device,e,"f",a),"inColor"),R=u.getUniformLocation(__classPrivateFieldGet(Device,e,"f",a),"inPos"),F=u.getUniformLocation(__classPrivateFieldGet(Device,e,"f",a),"inDir");if(null===_||null===R||null===F)throw new Error("Fatal error.");u.useProgram(__classPrivateFieldGet(Device,e,"f",a)),u.uniform1i(_,0),u.uniform1i(R,1),u.uniform1i(F,2),__classPrivateFieldSet(Device,e,0,"f",v),__classPrivateFieldSet(Device,e,i,"f",E),__classPrivateFieldSet(Device,e,f,"f",h),__classPrivateFieldSet(Device,e,s,"f",T),__classPrivateFieldGet(Device,e,"m",p).call(Device),u.viewport(0,0,i,f),window.addEventListener("keydown",(r=>{var i,t;"ArrowUp"===r.code&&__classPrivateFieldSet(i=Device,e,__classPrivateFieldGet(i,e,"f",m)-.05*Math.PI,"f",m),"ArrowDown"===r.code&&__classPrivateFieldSet(t=Device,e,__classPrivateFieldGet(t,e,"f",m)+.05*Math.PI,"f",m)}))}static draw(i){var o;const E=__classPrivateFieldGet(Device,e,"f",n);__classPrivateFieldSet(o=Device,e,__classPrivateFieldGet(o,e,"f",R)+.1*i,"f",R),__classPrivateFieldGet(Device,e,"m",C).call(Device),__classPrivateFieldGet(Device,e,"m",b).call(Device),E.bindFramebuffer(E.FRAMEBUFFER,__classPrivateFieldGet(Device,e,"f",f)),E.clear(E.COLOR_BUFFER_BIT),E.bindVertexArray(__classPrivateFieldGet(Device,e,"f",t)),E.useProgram(__classPrivateFieldGet(Device,e,"f",a)),E.bindBufferBase(E.UNIFORM_BUFFER,0,__classPrivateFieldGet(Device,e,"f",r)),__classPrivateFieldGet(Device,e,"m",O).call(Device,__classPrivateFieldGet(Device,e,"f",v)?__classPrivateFieldGet(Device,e,"f",_):__classPrivateFieldGet(Device,e,"f",d),0),__classPrivateFieldGet(Device,e,"m",O).call(Device,__classPrivateFieldGet(Device,e,"f",v)?__classPrivateFieldGet(Device,e,"f",u):__classPrivateFieldGet(Device,e,"f",s),1),__classPrivateFieldGet(Device,e,"m",O).call(Device,__classPrivateFieldGet(Device,e,"f",v)?__classPrivateFieldGet(Device,e,"f",D):__classPrivateFieldGet(Device,e,"f",l),2),E.drawArrays(E.TRIANGLES,0,6);for(let r=0;r<__classPrivateFieldGet(Device,e,"f",T);r++)__classPrivateFieldGet(Device,e,"m",x).call(Device),__classPrivateFieldGet(Device,e,"m",O).call(Device,__classPrivateFieldGet(Device,e,"f",v)?__classPrivateFieldGet(Device,e,"f",_):__classPrivateFieldGet(Device,e,"f",d),0),__classPrivateFieldGet(Device,e,"m",O).call(Device,__classPrivateFieldGet(Device,e,"f",v)?__classPrivateFieldGet(Device,e,"f",u):__classPrivateFieldGet(Device,e,"f",s),1),__classPrivateFieldGet(Device,e,"m",O).call(Device,__classPrivateFieldGet(Device,e,"f",v)?__classPrivateFieldGet(Device,e,"f",D):__classPrivateFieldGet(Device,e,"f",l),2),E.drawArrays(E.TRIANGLES,0,6);E.bindFramebuffer(E.FRAMEBUFFER,null),E.bindVertexArray(__classPrivateFieldGet(Device,e,"f",t)),E.useProgram(__classPrivateFieldGet(Device,e,"f",c)),__classPrivateFieldGet(Device,e,"m",O).call(Device,__classPrivateFieldGet(Device,e,"f",v)?__classPrivateFieldGet(Device,e,"f",d):__classPrivateFieldGet(Device,e,"f",_),0),E.drawArrays(E.TRIANGLES,0,6)}static setModelData(i){const t=__classPrivateFieldGet(Device,e,"f",n);t.bindBuffer(t.UNIFORM_BUFFER,__classPrivateFieldGet(Device,e,"f",r)),t.bufferSubData(t.UNIFORM_BUFFER,0,i);const o=`#version 300 es\nprecision highp float;\n#define FACES_COUNT ${i.length/16}\n`+L();__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",y).call(Device,S(),o),"f",a);const c=t.getUniformLocation(__classPrivateFieldGet(Device,e,"f",a),"inColor"),f=t.getUniformLocation(__classPrivateFieldGet(Device,e,"f",a),"inPos"),v=t.getUniformLocation(__classPrivateFieldGet(Device,e,"f",a),"inDir");if(null===c||null===f||null===v)throw new Error("Fatal error.");t.useProgram(__classPrivateFieldGet(Device,e,"f",a)),t.uniform1i(c,0),t.uniform1i(f,1),t.uniform1i(v,2)}static getCtx(){return __classPrivateFieldGet(Device,e,"f",n)}}e=Device,A=function _Device_createVAO(){const r=__classPrivateFieldGet(Device,e,"f",n),i=new Float32Array([-1,1,0,-1,-1,0,1,-1,0,-1,1,0,1,-1,0,1,1,0]),t=r.createBuffer();if(null===t)throw new Error("Fatal error.");r.bindBuffer(r.ARRAY_BUFFER,t),r.bufferData(r.ARRAY_BUFFER,i,r.STATIC_DRAW);const o=r.createVertexArray();if(null===o)throw new Error("Fatal error.");return r.bindVertexArray(o),r.enableVertexAttribArray(0),r.vertexAttribPointer(0,3,r.FLOAT,!1,0,0),r.bindVertexArray(null),o},p=function _Device_createLayer(){const r=__classPrivateFieldGet(Device,e,"f",n),i=r.createFramebuffer();if(null===i)throw new Error("Fatal error.");__classPrivateFieldSet(Device,e,i,"f",f),__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",U).call(Device),"f",s),__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",U).call(Device),"f",l),__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",U).call(Device),"f",u),__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",U).call(Device),"f",D),__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",U).call(Device),"f",d),__classPrivateFieldSet(Device,e,__classPrivateFieldGet(Device,e,"m",U).call(Device),"f",_),r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",_),0),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT1,r.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",u),0),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT2,r.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",D),0),r.drawBuffers([r.COLOR_ATTACHMENT0,r.COLOR_ATTACHMENT1,r.COLOR_ATTACHMENT2])},b=function _Device_initLayer(){const r=__classPrivateFieldGet(Device,e,"f",n),i=__classPrivateFieldGet(Device,e,"f",w);__classPrivateFieldSet(Device,e,0,"f",v),r.bindFramebuffer(r.FRAMEBUFFER,__classPrivateFieldGet(Device,e,"f",f)),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",_),0),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT1,r.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",u),0),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT2,r.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",D),0);const t=new Float32Array(__classPrivateFieldGet(Device,e,"f",E)*__classPrivateFieldGet(Device,e,"f",h)*4);r.bindTexture(r.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",d)),r.texSubImage2D(r.TEXTURE_2D,0,0,0,__classPrivateFieldGet(Device,e,"f",E),__classPrivateFieldGet(Device,e,"f",h),r.RGBA,r.FLOAT,t);for(let r=0;r<__classPrivateFieldGet(Device,e,"f",E)*__classPrivateFieldGet(Device,e,"f",h);r++)t[4*r+0]=i[9],t[4*r+1]=i[10],t[4*r+2]=i[11],t[4*r+3]=1;r.bindTexture(r.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",s)),r.texSubImage2D(r.TEXTURE_2D,0,0,0,__classPrivateFieldGet(Device,e,"f",E),__classPrivateFieldGet(Device,e,"f",h),r.RGBA,r.FLOAT,t);for(let r=0;r<__classPrivateFieldGet(Device,e,"f",h);r++)for(let n=0;n<__classPrivateFieldGet(Device,e,"f",E);n++){const o=4*(r*__classPrivateFieldGet(Device,e,"f",E)+n);let c=n/__classPrivateFieldGet(Device,e,"f",E)-.5,a=r/__classPrivateFieldGet(Device,e,"f",h)-.5,f=1;const v=1/Math.sqrt(c*c+a*a+f*f);c*=v,a*=v,f*=v,t[o+0]=c*i[0]+a*i[3]+f*i[6],t[o+1]=c*i[1]+a*i[4]+f*i[7],t[o+2]=c*i[2]+a*i[5]+f*i[8],t[o+3]=1}r.bindTexture(r.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",l)),r.texSubImage2D(r.TEXTURE_2D,0,0,0,__classPrivateFieldGet(Device,e,"f",E),__classPrivateFieldGet(Device,e,"f",h),r.RGBA,r.FLOAT,t)},x=function _Device_updateLayer(){var r;const i=__classPrivateFieldGet(Device,e,"f",n);__classPrivateFieldSet(r=Device,e,1^__classPrivateFieldGet(r,e,"f",v),"f",v),1===__classPrivateFieldGet(Device,e,"f",v)?(i.bindFramebuffer(i.FRAMEBUFFER,__classPrivateFieldGet(Device,e,"f",f)),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",d),0),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT1,i.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",s),0),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT2,i.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",l),0)):(i.bindFramebuffer(i.FRAMEBUFFER,__classPrivateFieldGet(Device,e,"f",f)),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",_),0),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT1,i.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",u),0),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT2,i.TEXTURE_2D,__classPrivateFieldGet(Device,e,"f",D),0));if(i.checkFramebufferStatus(i.FRAMEBUFFER)!==i.FRAMEBUFFER_COMPLETE)throw new Error("Fatal error.")},U=function _Device_createTexture(){const r=Device.getCtx(),i=r.createTexture();if(null===i)throw new Error("Fatal error.");return r.bindTexture(r.TEXTURE_2D,i),r.texStorage2D(r.TEXTURE_2D,1,r.RGBA32F,__classPrivateFieldGet(this,e,"f",E),__classPrivateFieldGet(this,e,"f",h)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),i},O=function _Device_bindTexture(r,i){const t=__classPrivateFieldGet(Device,e,"f",n);t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,r)},y=function _Device_createProgram(r,i){const t=__classPrivateFieldGet(Device,e,"f",n),o=t.createProgram();if(null===o)throw new Error("Fatal error.");const c=t.createShader(t.VERTEX_SHADER),a=t.createShader(t.FRAGMENT_SHADER);if(null===c||null===a)throw new Error("Fatal error.");if(t.shaderSource(c,r),t.shaderSource(a,i),t.compileShader(c),t.compileShader(a),!1===t.getShaderParameter(c,t.COMPILE_STATUS)||!1===t.getShaderParameter(a,t.COMPILE_STATUS))throw console.info(t.getShaderInfoLog(c)),console.info(t.getShaderInfoLog(a)),new Error("Shader error.");if(t.attachShader(o,c),t.attachShader(o,a),t.linkProgram(o),!1===t.getProgramParameter(o,t.LINK_STATUS))throw new Error("Shader program link status:"+t.getProgramInfoLog(o));t.deleteShader(c),t.deleteShader(a);const f=t.getUniformBlockIndex(o,"tn_camera");return f!==t.INVALID_INDEX&&t.uniformBlockBinding(o,f,0),o},M=function _Device_createUBO(){const r=__classPrivateFieldGet(Device,e,"f",n),i=r.createBuffer();if(null===i)throw new Error("Fatal error.");return r.bindBuffer(r.UNIFORM_BUFFER,i),r.bufferData(r.UNIFORM_BUFFER,65536,r.STATIC_DRAW),i},C=function _Device_calcMatrix(){const r=__classPrivateFieldGet(Device,e,"f",w),i=Math.cos(__classPrivateFieldGet(Device,e,"f",R)),t=Math.sin(__classPrivateFieldGet(Device,e,"f",R)),n=Math.cos(__classPrivateFieldGet(Device,e,"f",m)),o=Math.sin(__classPrivateFieldGet(Device,e,"f",m));r[0]=i,r[1]=0,r[2]=t,r[3]=t*o,r[4]=n,r[5]=-i*o,r[6]=-t*n,r[7]=o,r[8]=i*n,r[9]=-__classPrivateFieldGet(Device,e,"f",F)*r[6],r[10]=-__classPrivateFieldGet(Device,e,"f",F)*r[7],r[11]=-__classPrivateFieldGet(Device,e,"f",F)*r[8]},r={value:void 0},t={value:void 0},n={value:void 0},o={value:void 0},c={value:void 0},a={value:void 0},f={value:void 0},v={value:void 0},s={value:void 0},l={value:void 0},u={value:void 0},D={value:void 0},d={value:void 0},_={value:void 0},E={value:void 0},h={value:void 0},T={value:void 0},m={value:.25*-Math.PI},R={value:0},F={value:3},w={value:new Float32Array(12)};var X,q,matrix_classPrivateFieldGet=function(e,r,i,t){if("a"===i&&!t)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?e!==r||!t:!r.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?t:"a"===i?t.call(e):t?t.value:r.get(e)};class Matrix extends Float64Array{constructor(){super(12),this.set(matrix_classPrivateFieldGet(Matrix,X,"f",q))}fromAxes(e,r,i,t){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=r[0],this[4]=r[1],this[5]=r[2],this[6]=i[0],this[7]=i[1],this[8]=i[2],this[9]=t[0],this[10]=t[1],this[11]=t[2],this}invert(){const[e,r,i,t,n,o,c,a,f,v,s,l]=this,u=a*l-s*f,D=n*l-s*o,d=r*l-s*i,_=n*f-a*o,E=t*f-c*o,h=t*a-c*n,T=t*u-c*D+v*(n*f-a*o),m=r*f-a*i,R=e*f-c*i,F=e*a-c*r,w=e*u-c*d+v*(r*f-a*i),A=r*o-n*i,p=e*o-t*i,b=e*n-t*r,x=e*D-t*d+v*(r*o-n*i),U=1/(e*_-t*m+c*A),O=-U;return this[0]=_*U,this[1]=m*O,this[2]=A*U,this[3]=E*O,this[4]=R*U,this[5]=p*O,this[6]=h*U,this[7]=F*O,this[8]=b*U,this[9]=T*O,this[10]=w*U,this[11]=x*O,this}}X=Matrix,q={value:new Float64Array([1,0,0,0,1,0,0,0,1,0,0,0])};class Vector extends Float64Array{constructor(e=0,r=0,i=0){super(4),this[0]=e,this[1]=r,this[2]=i}from(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this}add(e){return this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],this}sub(e){return this[0]-=e[0],this[1]-=e[1],this[2]-=e[2],this}cross(e){const[r,i,t]=this,[n,o,c]=e;return this[0]=i*c-t*o,this[1]=t*n-r*c,this[2]=r*o-i*n,this}normalize(){const[e,r,i]=this,t=1/Math.sqrt(e*e+r*r+i*i);return this[0]*=t,this[1]*=t,this[2]*=t,this}apply(e){const[r,i,t,n,o,c,a,f,v,s,l,u]=e,[D,d,_]=this;return this[0]=r*D+n*d+a*_+s,this[1]=i*D+o*d+f*_+l,this[2]=t*D+c*d+v*_+u,this}}const H=new URLSearchParams(window.location.search).get("size"),V=new URLSearchParams(window.location.search).get("rays"),z=Number.parseInt(H??"512",10),j=Number.parseInt(V??"30",10);Device.create(z,z,j);let G=0;const W=new class Model{constructor(){this.faces=[],this.data=new Float32Array(0)}async load(e){const r=await fetch(e);if(!1===r.ok)throw new Error("Model not found.");this.faces=await r.json(),this.data=new Float32Array(16*this.faces.length);for(let e=0;e<this.faces.length;e++){const r=this.faces[e],i=new Vector(r.a.x,r.a.y,r.a.z),t=new Vector(r.b.x,r.b.y,r.b.z),n=new Vector(r.c.x,r.c.y,r.c.z),o=(new Vector).from(i).sub(n),c=(new Vector).from(t).sub(n),a=(new Vector).from(o).cross(c).normalize(),f=(new Vector).from(a).sub(n),v=(new Matrix).fromAxes(o,c,f,n).invert();this.data[16*e+0]=v[0],this.data[16*e+1]=v[3],this.data[16*e+2]=v[6],this.data[16*e+3]=v[9],this.data[16*e+4]=v[1],this.data[16*e+5]=v[4],this.data[16*e+6]=v[7],this.data[16*e+7]=v[10],this.data[16*e+8]=v[2],this.data[16*e+9]=v[5],this.data[16*e+10]=v[8],this.data[16*e+11]=v[11],this.data[16*e+12]=a[0],this.data[16*e+13]=a[1],this.data[16*e+14]=a[2],this.data[16*e+15]=0}}};W.load("./test.json").then((()=>{Device.setModelData(W.data)}));const loop=e=>{Device.draw(.001*(e-G)),G=e,requestAnimationFrame(loop)};requestAnimationFrame(loop)})(),i})()));