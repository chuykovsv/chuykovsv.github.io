!function webpackUniversalModuleDefinition(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.appLibrary=e():t.appLibrary=e()}(this,(()=>(()=>{"use strict";var t={r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e);var i,r,s,a,n,o,h,f,l,d,w,c,u,m,b,g,E,p,T,_,y,v,x,S,A,D,C,P,R,V,B,M,U,__classPrivateFieldSet=function(t,e,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(t,i):s?s.value=i:e.set(t,i),i},__classPrivateFieldGet=function(t,e,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(t):r?r.value:e.get(t)};const F="WebGL error.";class Viewer{constructor(t={}){i.add(this),r.set(this,void 0),s.set(this,void 0),a.set(this,void 0),n.set(this,void 0),o.set(this,void 0),h.set(this,void 0),f.set(this,void 0),l.set(this,void 0),d.set(this,void 0),w.set(this,void 0),c.set(this,void 0);const{root:e=document.body}=t,u=document.createElement("canvas");u.width=1,u.height=1,u.style.cssText="position:absolute;top:0px;left:0px;width:100%;height:100%;touch-action:none;",u.oncontextmenu=()=>!1,e.appendChild(u);const m=u.getContext("webgl2",{alpha:!0,preserveDrawingBuffer:!0,premultipliedAlpha:!0,antialias:!0});if(null===m)throw new Error(F);m.clearColor(0,0,0,0),m.enable(m.DEPTH_TEST),m.blendFunc(m.ONE,m.ONE_MINUS_SRC_ALPHA),__classPrivateFieldSet(this,r,m,"f"),__classPrivateFieldSet(this,s,e,"f"),__classPrivateFieldSet(this,a,u,"f"),__classPrivateFieldSet(this,n,1,"f"),__classPrivateFieldSet(this,o,new Map,"f"),__classPrivateFieldSet(this,h,new TextDecoder,"f"),__classPrivateFieldSet(this,f,null,"f"),__classPrivateFieldSet(this,l,[],"f")}async init(){const t={cos:Math.cos,sin:Math.sin,tan:Math.tan,acos:Math.acos,atan2:Math.atan2,error:__classPrivateFieldGet(this,i,"m",m).bind(this),console:console.info,getData:__classPrivateFieldGet(this,i,"m",b).bind(this),clearData:__classPrivateFieldGet(this,i,"m",g).bind(this),wglClear:__classPrivateFieldGet(this,r,"f").clear.bind(__classPrivateFieldGet(this,r,"f")),wglEnable:__classPrivateFieldGet(this,r,"f").enable.bind(__classPrivateFieldGet(this,r,"f")),wglDisable:__classPrivateFieldGet(this,r,"f").disable.bind(__classPrivateFieldGet(this,r,"f")),wglClearColor:__classPrivateFieldGet(this,r,"f").clearColor.bind(__classPrivateFieldGet(this,r,"f")),wglCreateBuffer:__classPrivateFieldGet(this,i,"m",p).bind(this),wglDeleteBuffer:__classPrivateFieldGet(this,i,"m",T).bind(this),wglBindBuffer:__classPrivateFieldGet(this,i,"m",_).bind(this),wglBindBufferBase:__classPrivateFieldGet(this,i,"m",y).bind(this),wglBufferSubData:__classPrivateFieldGet(this,i,"m",v).bind(this),wglCreateShader:__classPrivateFieldGet(this,i,"m",x).bind(this),wglUseShader:__classPrivateFieldGet(this,i,"m",S).bind(this),wglVertexAttribPointer:__classPrivateFieldGet(this,i,"m",A).bind(this),wglVertexAttribIPointer:__classPrivateFieldGet(this,i,"m",D).bind(this),wglEnableVertexAttribArray:__classPrivateFieldGet(this,i,"m",C).bind(this),wglVertexAttribDivisor:__classPrivateFieldGet(this,i,"m",P).bind(this),wglDrawElements:__classPrivateFieldGet(this,i,"m",R).bind(this),wglDrawElementsInstanced:__classPrivateFieldGet(this,i,"m",V).bind(this),wglCreateTexture:__classPrivateFieldGet(this,i,"m",B).bind(this),wglBindTexture:__classPrivateFieldGet(this,i,"m",M).bind(this),wglTextureSubData:__classPrivateFieldGet(this,i,"m",U).bind(this)},{instance:e}=await WebAssembly.instantiateStreaming(fetch("./main.wasm"),{e:t});__classPrivateFieldSet(this,c,e.exports,"f"),__classPrivateFieldSet(this,d,new Uint8Array(__classPrivateFieldGet(this,c,"f").memory.buffer),"f"),__classPrivateFieldSet(this,w,new DataView(__classPrivateFieldGet(this,c,"f").memory.buffer),"f"),__classPrivateFieldGet(this,c,"f").init(),__classPrivateFieldGet(this,s,"f").addEventListener("pointerenter",(t=>{__classPrivateFieldGet(this,l,"f").push({id:t.pointerId,type:t.pointerType,x:t.clientX,y:t.clientY,mx:t.movementX,my:t.movementY,buttons:t.buttons})})),__classPrivateFieldGet(this,s,"f").addEventListener("pointerleave",(t=>{__classPrivateFieldSet(this,l,__classPrivateFieldGet(this,l,"f").filter((e=>e.id!==t.pointerId)),"f")})),__classPrivateFieldGet(this,s,"f").addEventListener("pointermove",(t=>{for(const e of __classPrivateFieldGet(this,l,"f"))e.id===t.pointerId&&(e.x=t.clientX,e.y=t.clientY,e.mx=t.movementX,e.my=t.movementY,e.buttons=t.buttons)})),__classPrivateFieldGet(this,s,"f").addEventListener("wheel",(t=>{t.deltaY>0?__classPrivateFieldGet(this,c,"f").updateCamera(0,0,1.25,0,0):__classPrivateFieldGet(this,c,"f").updateCamera(0,0,.8,0,0)}))}async load(t){const e=await fetch(t);if(!1===e.ok)throw new Error("File not found");__classPrivateFieldSet(this,f,await e.arrayBuffer(),"f"),__classPrivateFieldGet(this,c,"f").parseWSMDL()}draw(){const t=window.devicePixelRatio,e=Math.round(__classPrivateFieldGet(this,s,"f").clientWidth*t),n=Math.round(__classPrivateFieldGet(this,s,"f").clientHeight*t);__classPrivateFieldGet(this,a,"f").width=e,__classPrivateFieldGet(this,a,"f").height=n,__classPrivateFieldGet(this,r,"f").viewport(0,0,e,n),__classPrivateFieldGet(this,i,"m",u).call(this),__classPrivateFieldGet(this,c,"f").resize(e,n),__classPrivateFieldGet(this,c,"f").draw()}raycast(t,e){const i=__classPrivateFieldGet(this,c,"f").raycast(t,e);return-1!==i?i:null}setColor(t,e){__classPrivateFieldGet(this,c,"f").setColor(t,e)}setVisibility(t,e){__classPrivateFieldGet(this,c,"f").setVisibility(t,e)}setRenderMode(t){__classPrivateFieldGet(this,c,"f").setRenderMode(t)}setGhostColor(t,e,i,r){__classPrivateFieldGet(this,c,"f").setGhostColor(t,e,i,r)}setClearColor(t,e,i,r){__classPrivateFieldGet(this,c,"f").setClearColor(t,e,i,r)}getCamera(){const t=__classPrivateFieldGet(this,c,"f").getCameraPtr();return{polar:__classPrivateFieldGet(this,w,"f").getFloat32(t,!0),azimuthal:__classPrivateFieldGet(this,w,"f").getFloat32(t+4,!0),distance:__classPrivateFieldGet(this,w,"f").getFloat32(t+8,!0),target:{x:__classPrivateFieldGet(this,w,"f").getFloat32(t+12,!0),y:__classPrivateFieldGet(this,w,"f").getFloat32(t+16,!0),z:__classPrivateFieldGet(this,w,"f").getFloat32(t+20,!0)}}}setCamera(t){const e=__classPrivateFieldGet(this,c,"f").getCameraPtr();__classPrivateFieldGet(this,w,"f").setFloat32(e,t.polar,!0),__classPrivateFieldGet(this,w,"f").setFloat32(e+4,t.azimuthal,!0),__classPrivateFieldGet(this,w,"f").setFloat32(e+8,t.distance,!0),__classPrivateFieldGet(this,w,"f").setFloat32(e+12,t.target.x,!0),__classPrivateFieldGet(this,w,"f").setFloat32(e+16,t.target.y,!0),__classPrivateFieldGet(this,w,"f").setFloat32(e+20,t.target.z,!0),__classPrivateFieldGet(this,c,"f").updateCamera(0,0,0,0,0)}}r=new WeakMap,s=new WeakMap,a=new WeakMap,n=new WeakMap,o=new WeakMap,h=new WeakMap,f=new WeakMap,l=new WeakMap,d=new WeakMap,w=new WeakMap,c=new WeakMap,i=new WeakSet,u=function _Viewer_pointerEvents(){__classPrivateFieldGet(this,l,"f").sort(((t,e)=>t.type.charCodeAt(0)-e.type.charCodeAt(0)));const t=window.devicePixelRatio;if(1===__classPrivateFieldGet(this,l,"f").length){const e=.01*__classPrivateFieldGet(this,l,"f")[0].mx*t,i=.01*__classPrivateFieldGet(this,l,"f")[0].my*t;"mouse"===__classPrivateFieldGet(this,l,"f")[0].type?(0!=(1&__classPrivateFieldGet(this,l,"f")[0].buttons)&&__classPrivateFieldGet(this,c,"f").updateCamera(e,i,1,0,0),0!=(2&__classPrivateFieldGet(this,l,"f")[0].buttons)&&__classPrivateFieldGet(this,c,"f").updateCamera(0,0,1,e,i)):__classPrivateFieldGet(this,c,"f").updateCamera(e,i,1,0,0)}else if(__classPrivateFieldGet(this,l,"f").length>1){const e=__classPrivateFieldGet(this,l,"f")[0].mx,i=__classPrivateFieldGet(this,l,"f")[0].my,r=__classPrivateFieldGet(this,l,"f")[1].mx,s=__classPrivateFieldGet(this,l,"f")[1].my;if(e*r+i*s>0){const a=(e+r)*t*.005,n=(i+s)*t*.005;__classPrivateFieldGet(this,c,"f").updateCamera(0,0,1,a,n)}else{const t=__classPrivateFieldGet(this,l,"f")[1].x-__classPrivateFieldGet(this,l,"f")[0].x,a=__classPrivateFieldGet(this,l,"f")[1].y-__classPrivateFieldGet(this,l,"f")[0].y,n=t*t+a*a-((t+r-e)**2+(a+s-i)**2);n>5?__classPrivateFieldGet(this,c,"f").updateCamera(0,0,1.1,0,0):n<-5&&__classPrivateFieldGet(this,c,"f").updateCamera(0,0,.9,0,0)}}for(const t of __classPrivateFieldGet(this,l,"f"))t.mx=0,t.my=0},m=function _Viewer_error(t){throw new Error(t.toString())},b=function _Viewer_getData(t,e,i){return!(null===__classPrivateFieldGet(this,f,"f")||i+e>__classPrivateFieldGet(this,f,"f").byteLength)&&(__classPrivateFieldGet(this,d,"f").set(new Uint8Array(__classPrivateFieldGet(this,f,"f"),e,i),t),!0)},g=function _Viewer_clearData(){__classPrivateFieldSet(this,f,null,"f")},E=function _Viewer_getStringFormPtr(t){let e=0;for(;0!==__classPrivateFieldGet(this,d,"f")[t+e];)e++;return __classPrivateFieldGet(this,h,"f").decode(new Uint8Array(__classPrivateFieldGet(this,d,"f").buffer,t,e))},p=function _Viewer_wglCreateBuffer(t,e){var i,s;const a=__classPrivateFieldGet(this,r,"f"),h=(__classPrivateFieldSet(this,n,(s=__classPrivateFieldGet(this,n,"f"),i=s++,s),"f"),i),f=a.createBuffer();if(null===f)throw new Error(F);return __classPrivateFieldGet(this,o,"f").set(h,f),a.bindBuffer(t,f),a.bufferData(t,e,a.STATIC_DRAW),a.bindBuffer(t,null),h},T=function _Viewer_wglDeleteBuffer(t){__classPrivateFieldGet(this,r,"f").deleteBuffer(__classPrivateFieldGet(this,o,"f").get(t)),__classPrivateFieldGet(this,o,"f").delete(t)},_=function _Viewer_wglBindBuffer(t,e){__classPrivateFieldGet(this,r,"f").bindBuffer(e,__classPrivateFieldGet(this,o,"f").get(t))},y=function _Viewer_wglBindBufferBase(t,e){__classPrivateFieldGet(this,r,"f").bindBufferBase(__classPrivateFieldGet(this,r,"f").UNIFORM_BUFFER,e,__classPrivateFieldGet(this,o,"f").get(t))},v=function _Viewer_wglBufferSubData(t,e,i,s,a){const n=__classPrivateFieldGet(this,r,"f");n.bindBuffer(e,__classPrivateFieldGet(this,o,"f").get(t)),n.bufferSubData(e,i,__classPrivateFieldGet(this,d,"f"),s,a)},x=function _Viewer_wglCreateShader(t,e){var s,a;const h=__classPrivateFieldGet(this,r,"f"),f=(__classPrivateFieldSet(this,n,(a=__classPrivateFieldGet(this,n,"f"),s=a++,a),"f"),s),l=h.createProgram();if(null===l)throw new Error("Fatal error.");__classPrivateFieldGet(this,o,"f").set(f,l);const d=h.createShader(h.VERTEX_SHADER),w=h.createShader(h.FRAGMENT_SHADER);if(null===d||null===w)throw new Error("Fatal error.");const c=__classPrivateFieldGet(this,i,"m",E).call(this,t),u=__classPrivateFieldGet(this,i,"m",E).call(this,e);if(h.shaderSource(d,c),h.shaderSource(w,u),h.compileShader(d),h.compileShader(w),!1===h.getShaderParameter(d,h.COMPILE_STATUS)||!1===h.getShaderParameter(w,h.COMPILE_STATUS))throw console.info(h.getShaderInfoLog(d),f),console.info(h.getShaderInfoLog(w)),new Error("Shader error.");if(h.attachShader(l,d),h.attachShader(l,w),h.linkProgram(l),!1===h.getProgramParameter(l,h.LINK_STATUS))throw new Error("Shader program link status:"+h.getProgramInfoLog(l));h.deleteShader(d),h.deleteShader(w);const m=h.getUniformBlockIndex(l,"uniforms");m!==h.INVALID_INDEX&&h.uniformBlockBinding(l,m,0),h.useProgram(l);const b=h.getUniformLocation(l,"cTexture"),g=h.getUniformLocation(l,"mTexture");return h.uniform1i(b,0),h.uniform1i(g,1),f},S=function _Viewer_wglUseShader(t){__classPrivateFieldGet(this,r,"f").useProgram(__classPrivateFieldGet(this,o,"f").get(t))},A=function _Viewer_wglVertexAttribPointer(t,e,i,s,a,n){__classPrivateFieldGet(this,r,"f").vertexAttribPointer(t,e,i,s,a,n)},D=function _Viewer_wglVertexAttribIPointer(t,e,i,s,a){__classPrivateFieldGet(this,r,"f").vertexAttribIPointer(t,e,i,s,a)},C=function _Viewer_wglEnableVertexAttribArray(t){__classPrivateFieldGet(this,r,"f").enableVertexAttribArray(t)},P=function _Viewer_wglVertexAttribDivisor(t,e){__classPrivateFieldGet(this,r,"f").vertexAttribDivisor(t,e)},R=function _Viewer_wglDrawElements(t,e,i,s){__classPrivateFieldGet(this,r,"f").drawElements(t,e,i,s)},V=function _Viewer_wglDrawElementsInstanced(t,e,i,s,a){__classPrivateFieldGet(this,r,"f").drawElementsInstanced(t,e,i,s,a)},B=function _Viewer_wglCreateTexture(t,e,i){var s,a;const h=__classPrivateFieldGet(this,r,"f"),f=(__classPrivateFieldSet(this,n,(a=__classPrivateFieldGet(this,n,"f"),s=a++,a),"f"),s),l=h.createTexture();if(null===l)throw new Error(F);return __classPrivateFieldGet(this,o,"f").set(f,l),h.bindTexture(h.TEXTURE_2D,l),h.texStorage2D(h.TEXTURE_2D,1,t,e,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.bindTexture(h.TEXTURE_2D,null),f},M=function _Viewer_wglBindTexture(t,e){const i=__classPrivateFieldGet(this,r,"f");i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,__classPrivateFieldGet(this,o,"f").get(t))},U=function _Viewer_wglTextureSubData(t,e,i,s,a,n){const h=__classPrivateFieldGet(this,r,"f");let f,l;switch(s){case h.RED:f=1;break;case h.RG:f=2;break;case h.RGB:f=3;break;case h.RGBA:f=4;break;default:throw new Error(F)}switch(a){case h.UNSIGNED_BYTE:l=new Uint8Array(__classPrivateFieldGet(this,d,"f").buffer,n,e*i*f);break;case h.FLOAT:l=new Float32Array(__classPrivateFieldGet(this,d,"f").buffer,n,e*i*f);break;default:throw new Error(F)}h.bindTexture(h.TEXTURE_2D,__classPrivateFieldGet(this,o,"f").get(t)),h.texSubImage2D(h.TEXTURE_2D,0,0,0,e,i,s,a,l),h.bindTexture(h.TEXTURE_2D,null)};var I,simple_classPrivateFieldGet=function(t,e,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(t):r?r.value:e.get(t)};class App{constructor(){this.viewer=new Viewer,I.set(this,(()=>{this.viewer.draw(),requestAnimationFrame(simple_classPrivateFieldGet(this,I,"f"))}))}async init(){await this.viewer.init(),requestAnimationFrame(simple_classPrivateFieldGet(this,I,"f"))}async load(t){await this.viewer.load(t)}}return I=new WeakMap,(async()=>{const t=new App;await t.init();const e=window.location.search.slice(1)||"test";await t.load(`../assets/${e}.wsmdl`),window.addEventListener("click",(e=>{const i=2*(e.clientX/window.innerWidth-.5),r=2*(.5-e.clientY/window.innerHeight),s=t.viewer.raycast(i,r);null!==s&&t.viewer.setColor(s,255)})),window.app=t})(),e})()));